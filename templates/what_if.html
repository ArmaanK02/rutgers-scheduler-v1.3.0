<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>What-If Analysis - Scarlet Scheduler</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="app-body">
    
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h3><i class="fas fa-calendar-alt"></i> Scarlet Scheduler</h3>
        </div>
        
        <div class="nav-links" style="margin-top: 20px;">
            <a href="{{ url_for('chat_interface') }}" class="nav-item"><i class="fas fa-comments"></i> Chat</a>
            <a href="{{ url_for('history_dashboard') }}" class="nav-item"><i class="fas fa-history"></i> Course History</a>
            <a href="{{ url_for('progress_dashboard') }}" class="nav-item"><i class="fas fa-chart-line"></i> Major Progress</a>
            <a href="{{ url_for('what_if_dashboard') }}" class="nav-item active"><i class="fas fa-random"></i> What-If?</a>
            <a href="{{ url_for('degree_map_dashboard') }}" class="nav-item"><i class="fas fa-project-diagram"></i> Degree Map</a>
        </div>
        
        <div class="user-profile" style="margin-top: auto;">
            <div class="user-info">
                <div class="avatar">{{ user.username[0].upper() }}</div>
                <span>{{ user.username }}</span>
            </div>
            <a href="{{ url_for('logout') }}" class="btn-logout"><i class="fas fa-sign-out-alt"></i></a>
        </div>
    </aside>

    <main class="main-content">
        <div class="content-header">
            <h2>What-If Analysis</h2>
        </div>

        <div class="data-card">
            <h3>Explore a New Major</h3>
            <p style="color: #aaa; margin-bottom: 20px;">See how your current credits apply to a different major.</p>
            
            <div class="progress-controls">
                <select id="what-if-major" class="dropdown-lg">
                    <option value="">-- Select Target Major --</option>
                    {% for major in majors %}
                        <option value="{{ major }}">{{ major }}</option>
                    {% endfor %}
                </select>
                <button onclick="runWhatIf()" class="btn btn-primary">Analyze</button>
            </div>
        </div>

        <div id="what-if-results" style="display: none; margin-top: 20px;">
            <div class="data-card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>Compatibility Score</h3>
                    <h2 id="match-score" style="color: var(--accent-red);">0%</h2>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="match-bar" style="width: 0%"></div>
                </div>
            </div>

            <div class="progress-grid">
                <div class="data-card">
                    <h4><i class="fas fa-check-double text-success"></i> Transferable Courses</h4>
                    <p style="font-size: 0.9rem; color: #aaa; margin-bottom: 10px;">These courses count towards the new major.</p>
                    <ul class="req-list" id="transfer-list"></ul>
                </div>
                <div class="data-card">
                    <h4><i class="fas fa-list text-secondary"></i> New Requirements</h4>
                    <p style="font-size: 0.9rem; color: #aaa; margin-bottom: 10px;">Courses you would need to take.</p>
                    <ul class="req-list" id="gap-list"></ul>
                </div>
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script>
        async function runWhatIf() {
            const major = document.getElementById('what-if-major').value;
            if(!major) return;
            
            try {
                const res = await fetch('/api/what_if', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({major})
                });
                const data = await res.json();
                
                document.getElementById('match-score').innerText = data.match_score + '%';
                document.getElementById('match-bar').style.width = data.match_score + '%';
                
                document.getElementById('transfer-list').innerHTML = data.matched.length ? 
                    data.matched.map(c => `<li><i class="fas fa-check"></i> ${c}</li>`).join('') :
                    '<li style="color: #666;">No matches found</li>';
                    
                document.getElementById('gap-list').innerHTML = data.remaining.length ?
                    data.remaining.map(c => `<li><i class="fas fa-plus"></i> ${c}</li>`).join('') :
                    '<li>All requirements met!</li>';
                
                document.getElementById('what-if-results').style.display = 'block';
            } catch (err) {
                console.error(err);
                alert("Analysis failed.");
            }
        }
    </script>
</body>
</html>