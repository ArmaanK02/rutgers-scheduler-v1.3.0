<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Degree Map - Scarlet Scheduler</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Cytoscape.js for Graphs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.23.0/cytoscape.min.js"></script>
</head>
<body class="app-body">
    
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h3><i class="fas fa-calendar-alt"></i> Scarlet Scheduler</h3>
        </div>
        
        <div class="nav-links" style="margin-top: 20px;">
            <a href="{{ url_for('chat_interface') }}" class="nav-item"><i class="fas fa-comments"></i> Chat</a>
            <a href="{{ url_for('history_dashboard') }}" class="nav-item"><i class="fas fa-history"></i> Course History</a>
            <a href="{{ url_for('progress_dashboard') }}" class="nav-item"><i class="fas fa-chart-line"></i> Major Progress</a>
            <a href="{{ url_for('what_if_dashboard') }}" class="nav-item"><i class="fas fa-random"></i> What-If?</a>
            <a href="{{ url_for('degree_map_dashboard') }}" class="nav-item active"><i class="fas fa-project-diagram"></i> Degree Map</a>
        </div>
        
        <div class="user-profile" style="margin-top: auto;">
            <div class="user-info">
                <div class="avatar">{{ user.username[0].upper() }}</div>
                <span>{{ user.username }}</span>
            </div>
            <a href="{{ url_for('logout') }}" class="btn-logout"><i class="fas fa-sign-out-alt"></i></a>
        </div>
    </aside>

    <main class="main-content" style="display: flex; flex-direction: column;">
        <div class="content-header">
            <h2>Degree Dependency Map</h2>
        </div>

        <div class="data-card" style="flex: 1; display: flex; flex-direction: column; padding: 0; overflow: hidden;">
            <div id="cy" style="width: 100%; height: 100%; min-height: 600px; background: #1a1a1a;"></div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const res = await fetch('/api/degree_graph');
                const data = await res.json();
                
                const cy = cytoscape({
                    container: document.getElementById('cy'),
                    elements: data.elements,
                    style: [
                        {
                            selector: 'node',
                            style: {
                                'background-color': 'data(color)',
                                'label': 'data(label)',
                                'color': '#fff',
                                'text-valign': 'center',
                                'text-halign': 'center',
                                'font-family': 'Inter, sans-serif',
                                'width': '60px',
                                'height': '60px'
                            }
                        },
                        {
                            selector: 'edge',
                            style: {
                                'width': 3,
                                'line-color': '#555',
                                'target-arrow-color': '#555',
                                'target-arrow-shape': 'triangle',
                                'curve-style': 'bezier'
                            }
                        }
                    ],
                    layout: {
                        name: 'breadthfirst',
                        directed: true,
                        padding: 10,
                        spacingFactor: 1.5
                    }
                });
                
            } catch (err) {
                console.error("Graph init failed", err);
            }
        });
    </script>
</body>
</html>